<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=1">
  <title>Top Listas por Categoria</title>
  <link rel="icon" href="https://raw.githubusercontent.com/100ratings/top/main/star.png" type="image/png">
  <link href="https://fonts.googleapis.com/css2?family=Source+Sans+Pro:wght@400;700&display=swap" rel="stylesheet">
  <style>
    body {
      margin: 0;
      background: #f5f5f5;
      font-family: 'Source Sans Pro', sans-serif;
      color: #333;
      position: relative;
      min-height: 100vh;
      padding-bottom: 60px;
    }
    #content { padding: 30px 10px; }
    #content .inner { max-width: 600px; margin: 0 auto; }
    #blocks { display: flex; flex-direction: column; gap: 10px; }
    .selectblock {
      display: flex; align-items: center; background: #fff;
      border-radius: 6px; box-shadow: 0 1px 4px rgba(0,0,0,0.1);
      text-decoration: none; color: #333; padding: 15px;
      font-size: 1.1em; cursor: pointer; transition: background 0.2s, transform 0.1s;
      justify-content: space-between;
    }
    .selectblock:hover { background: #f0f0f0; }
    .selectblock:active { transform: translateX(2px); }
    #footer {
      max-width: 600px; margin: 20px auto 5px auto; text-align: center;
      font-size: 0.97em; color: #666; padding: 0 10px;
      position: fixed; bottom: 0; left: 0; right: 0;
      background: #f5f5f5; box-shadow: 0 -2px 10px rgba(0,0,0,0.04);
    }
    #addForm { display: none; margin-top: 12px; text-align: center; }
    #addForm input {
      padding: 5px 7px; margin-right: 8px; border: 1px solid #ccc;
      border-radius: 4px; font-size: 1em;
    }
    #addForm button {
      padding: 6px 14px; border: none; background: #2c99c4;
      color: white; border-radius: 4px; font-size: 1em; cursor: pointer;
    }
    #addLinkBtn {
      background: #2c99c4; color: white; padding: 10px 20px; border: none;
      border-radius: 5px; font-size: 1em; cursor: pointer; transition: background 0.2s; margin-top: 10px;
    }
    #addLinkBtn:hover { background: #206d90; }
  </style>
</head>
<body>
  <div id="content">
    <div class="inner">
      <div id="blocks">
        <!-- Os links serão carregados aqui pelo JS -->
      </div>
    </div>
  </div>

  <div id="footer">
    <button id="addLinkBtn">Adicionar link</button>
    <form id="addForm">
      <input type="text" id="nomeLink" placeholder="Nome" required>
      <input type="url" id="urlLink" placeholder="URL" required>
      <button type="submit">Salvar</button>
    </form>
  </div>
  
  <script type="module">
    import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";

    // Suas credenciais Supabase
    const supabaseUrl = 'https://epgitxwnblwltpbflujy.supabase.co';
    const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVwZ2l0eHduYmx3bHRwYmZsdWp5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTMxOTI2NzcsImV4cCI6MjA2ODc2ODY3N30.b7kCFs7qd3w1AF0YPuEzl87dPl7xCwvb596ka3KfJOQ';
    const supabase = createClient(supabaseUrl, supabaseKey);

    const blocks = document.getElementById('blocks');
    const addLinkBtn = document.getElementById('addLinkBtn');
    const addForm = document.getElementById('addForm');

    // Carrega os links do Supabase
    async function loadLinks() {
      blocks.innerHTML = '';
      const { data, error } = await supabase.from('links').select('*').order('id', { ascending: true });
      if (error) {
        blocks.innerHTML = '<div>Erro ao carregar links.</div>';
        return;
      }
      data.forEach(link => {
        addLinkBlock(link.nome, link.url);
      });
    }

    // Cria o bloco visual do link
    function addLinkBlock(nome, url) {
      const div = document.createElement('div');
      div.className = 'selectblock';
      div.textContent = nome;
      div.setAttribute('data-url', url);
      div.onclick = function() { window.location.replace(url); }
      blocks.appendChild(div);
    }

    // Mostrar/esconder formulário
    addLinkBtn.addEventListener('click', function() {
      addForm.style.display = addForm.style.display === 'block' ? 'none' : 'block';
    });

    // Adiciona novo link ao Supabase
    addForm.addEventListener('submit', async function(e) {
      e.preventDefault();
      const nome = document.getElementById('nomeLink').value.trim();
      const url = document.getElementById('urlLink').value.trim();
      if (nome && url) {
        const { error } = await supabase.from('links').insert([{ nome, url }]);
        if (error) {
          alert('Erro ao salvar link!');
        } else {
          addForm.reset();
          addForm.style.display = 'none';
          loadLinks(); // recarrega lista com novo link
        }
      }
    });

    // Carrega os links ao abrir a página
    loadLinks();
  </script>
</body>
</html>
